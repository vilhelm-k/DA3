---
title: "Hypothesis Testing and Mediation Analysis"
author: "Your Name"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Required Libraries and Data Import

```{r}
required_packages <- c(
    "rio", "ggplot2", "vtable", "plot3D",
    "corrplot", "regclass", "olsrr", "mediation", "multilevel", "stargazer"
)

for (i in 1:length(required_packages)) {
    if (!required_packages[i] %in% installed.packages()) {
        install.packages(required_packages[i])
    }
}

library(ggplot2)
library(rio)
library(mediation)

# Import data
df <- rio::import("BE603_gr_10.csv")
```

## Hypothesis 1: Community Effect (Mediation Analysis)

### Models and Bootstrap

```{r}
model_T <- lm(collected_funds ~ updates_count, data = df)
model_M <- lm(comments_count ~ updates_count, data = df)
model_Y <- lm(collected_funds ~ updates_count + comments_count, data = df)
model_all <- lm(collected_funds ~ ., data = df)


model_bootstrap <- mediation::mediate(
    model.m = model_M,
    model.y = model_Y,
    treat = "updates_count",
    mediator = "comments_count",
    boot = TRUE,
    sims = 2000
)
```

### Visualization
```{r,  results='asis'}
stargazer::stargazer(model_T, model_M, model_Y, type = "text")
```

```{r}
plot(model_bootstrap)
```
```{r}
# Plotting comments vs updates
ggplot(df) +
    aes(y = comments_count, x = updates_count) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    scale_x_log10() +
    scale_y_log10() +
    annotation_logticks(sides = "bl") +
    labs(
        y = "Comments Count",
        x = "Updates Count"
    ) +
    theme_classic()
```

```{r}
# Plotting collected funds vs updates
ggplot(df) +
    aes(y = collected_funds, x = updates_count) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Updates Count"
    ) +
    theme_classic()
```
```{r}
# Residuals for model_T
residuals_T <- residuals(model_T)
ggplot(data.frame(residuals = residuals_T)) +
    aes(x = residuals) +
    geom_histogram(binwidth = 1000, fill = "blue", alpha = 0.7, color = "black") +
    labs(title = "Residuals of Model_T", x = "Residuals", y = "Frequency") +
    theme_classic()

# Residuals for model_M
residuals_M <- residuals(model_M)
ggplot(data.frame(residuals = residuals_M)) +
    aes(x = residuals) +
    geom_histogram(binwidth = 10, fill = "green", alpha = 0.7, color = "black") +
    labs(title = "Residuals of Model_M", x = "Residuals", y = "Frequency") +
    theme_classic()

# Residuals for model_Y
residuals_Y <- residuals(model_Y)
ggplot(data.frame(residuals = residuals_Y)) +
    aes(x = residuals) +
    geom_histogram(binwidth = 1000, fill = "red", alpha = 0.7, color = "black") +
    labs(title = "Residuals of Model_Y", x = "Residuals", y = "Frequency") +
    theme_classic()
```

# Hypothesis 2: Social and Negative Emotion Interaction

### Model

```{r, results='asis'}
model_H2 <- lm(collected_funds ~ social * negemo, data = df)
stargazer::stargazer(model_H2, type = "text")
```

### Visualization

```{r}
df$social_factor <- as.factor(df$social)

ggplot(df) +
    aes(y = collected_funds, x = negemo, color = social_factor) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Negative emotion",
        color = "Social (0/1)"
    ) +
    scale_color_discrete(labels = c("No Social", "Social")) +
    theme_classic()
```
```{r}
residuals_H2 <- residuals(model_H2)
ggplot(data.frame(residuals = residuals_H2)) +
    aes(x = residuals) +
    geom_histogram(binwidth = 1000, fill = "blue", alpha = 0.7, color = "black") +
    labs(title = "Residuals of Model_T", x = "Residuals", y = "Frequency") +
    theme_classic()
```

## Hypothesis 3: Early Success

### Model and Visualization

```{r, results='asis'}
model_H3 <- lm(collected_funds ~ goal, data = df)
stargazer::stargazer(model_H3, type = "text")
```


```{r, results='asis'}
ggplot(df) +
    aes(y = collected_funds, x = goal) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Goal",
        title = "Correlation between goal and collected funds"
    ) +
    theme_classic()
```
```{r}
residuals_H3 <- residuals(model_H3)
ggplot(data.frame(residuals = residuals_H3)) +
    aes(x = residuals) +
    geom_histogram(binwidth = 1000, fill = "blue", alpha = 0.7, color = "black") +
    labs(title = "Residuals of Model_T", x = "Residuals", y = "Frequency") +
    theme_classic()
```