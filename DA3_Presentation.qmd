---
title: "Hypothesis Testing and Mediation Analysis"
author: "Vilhelm Karlin - 26012, Wilhelm Vänje - xxxxx, Pelle Alvemo - xxxxx"
format: 
  beamer:
    theme: "metropolis"
    fonttheme: professionalfonts
    aspectratio: 169
    fontsize: 10pt
    header-includes: |
      \usepackage{multicol}
      \usepackage{booktabs}
      \setbeamertemplate{navigation symbols}{}
      \setbeamertemplate{footline}[frame number]

      \setbeamercolor{block title}{bg=gray!20, fg=black} % Background color for block titles
      \setbeamercolor{block body}{bg=gray!8, fg=black}   % Background color for block body
      \setbeamerfont{block title}{series=\bfseries, size=\small} % Block title font
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.width = 4.5,
  fig.height = 3
)

# Load necessary libraries
library(ggplot2)
library(rio)
library(mediation)
library(modelsummary)
library(gridExtra)
library(kableExtra)

# Import dataset
df <- rio::import("BE603_gr_10.csv")
```

# Hypothesis 1: SLR

::: columns
::: {.column width="50%"}
## Variable identification
\small
- **Dependent variable (DV):** collected funds
- **Independent variable (IV):** goal

## Hypothesis statement
\small
- $H_0: \rho \leq 0$ There is no positive correlation between the goal and collected funds
- $H_1: \rho > 0$ There exists a positive correlation between the goal and collected funds

:::

::: {.column width="50%"}
## Theoretical justification
\scriptsize
The goal amount serves as an psychological factor for potential investors. Further, the IV goal, according to the signaling theory, acts as a signal of the campaigns scope and ambitious. High but realistic goals also indicates on well-thought through projects. Furthermore, higher goals usually requires more investors, creating “social proof” effect. Hence, increased numbers of investors will cause the campaign to create and gain momentum, attracting additional investors. However, studies on crowdfunding, highlights positive correlation between goal and collected funds  (belleflamme et al., 2014). 

## Empirical model
\small
$$
\text{Collected funds}=\beta_0 + \beta_1 \text{Goal} + \epsilon
$$
where $\epsilon$ is the normally distributed residual.
:::
:::

# Hypothesis 1: Results and analysis

```{r, results='asis'}
#| layout: [[1,1]]

model_H1 <- lm(collected_funds ~ goal, data = df)

stargazer::stargazer(model_H1,
  type = "latex",
  header = FALSE,
  font.size = "scriptsize",
  column.sep.width = "1pt",
  dep.var.labels = c("Collected Funds"),
  covariate.labels = c("$\\beta_1$ (Goal)", "$\\beta_0$ (Constant)"),
  omit.stat = c("ser", "f", "n"), 
  keep.stat = c("rsq"),
  star.char = c("*", "**", "***"),
  float = FALSE,
  no.space = TRUE,
  single.row = TRUE,
  model.numbers = FALSE,
  notes = "",
  add.lines = list(c("")),
  table.placement = "H")

ggplot(df) +
  aes(y = collected_funds, x = goal) +
  geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
  labs(
    y = "Collected funds",
    x = "Goal",
    title = "Correlation between goal and collected funds"
  ) +
  theme_classic() +
  theme(
    panel.background = element_rect(fill = "transparent"),
    plot.background = element_rect(fill = "transparent", color = NA)
  )
```

## Analysis 
\tiny The simple linear regression reveals a significant positive relationship between campaign goals and collected funds ($\beta_1 > 0$, $p < 0.001$). For every unit increase in the goal amount, there is a corresponding increase of `r round(coef(model_H1)[2], 3)` units in collected funds, with a baseline of `r round(coef(model_H1)[1], 0)` units ($\beta_0$). The model explains `r round(summary(model_H1)$r.squared * 100, 1)`% of the variance in collected funds ($R^2 = `r round(summary(model_H1)$r.squared, 3)`$), indicating a moderate fit. These results support rejecting $H_0$ in favor of $H_1$, confirming our theoretical expectation that higher goals are associated with higher funding outcomes.

# Community Effect: Mediation Analysis

```{r}
model_T <- lm(collected_funds ~ updates_count, data = df)
model_M <- lm(comments_count ~ updates_count, data = df)
model_Y <- lm(collected_funds ~ updates_count + comments_count, data = df)
model_all <- lm(collected_funds ~ ., data = df)

# Bootstrap model
model_bootstrap <- mediation::mediate(
    model.m = model_M,
    model.y = model_Y,
    treat = "updates_count",
    mediator = "comments_count",
    boot = TRUE,
    sims = 100
)
```

::: columns
::: {.column width="35%"}
\small
- Updates significantly affect collected funds (c = `r round(coef(model_T)[2], 3)`)
- Mediation through comments is significant
- Direct effect remains substantial (c' = `r round(coef(model_Y)[2], 3)`)

\small
Key findings from bootstrap:
- ACME: `r round(model_bootstrap$d0, 3)`
- Direct Effect: `r round(model_bootstrap$z0, 3)`
- Total Effect: `r round(model_bootstrap$tau.coef, 3)`
:::

::: {.column width="65%"}
```{r, results='asis'}
stargazer::stargazer(model_T, model_M, model_Y,
          type = "latex",
          header = FALSE,
          font.size = "tiny",
          no.space = TRUE,
          column.sep.width = "1pt",
          dep.var.labels = c("Collected Funds", "Comments", "Collected Funds"),
          covariate.labels = c("Updates Count", "Comments Count"),
          omit.stat = c("f", "ser", "n", "adj.rsq"),  # Remove observations and adjusted R^2
          star.char = c("*", "**", "***"),
          title = "",  # Remove title
          digits = 2,
          column.labels = c("Total Effect", "Mediator", "Direct Effect"),
          single.row = TRUE,
          model.numbers = FALSE,
          table.placement = "H")
```

```{r}
#| fig.width: 4
#| fig.height: 2
par(mar = c(3,3,3,1),
    cex.axis = 0.6,    # Axis label size
    cex.lab = 0.6,     # Axis title size
    cex.main = 1.0)
plot(model_bootstrap)
```

:::
:::

# Visualization of Relationships {.fragile}

::: columns
::: {.column width="50%"}
```{r}
#| fig.width: 4
#| fig.height: 3
# Comments vs Updates plot
ggplot(df) +
    aes(y = comments_count, x = updates_count) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    scale_x_log10() +
    scale_y_log10() +
    annotation_logticks(sides = "bl") +
    labs(
        y = "Comments Count",
        x = "Updates Count",
        title = "A. Comments vs Updates"
    ) +
    theme_classic() +
    theme(text = element_text(size = 8))
```
:::

::: {.column width="50%"}
```{r}
#| fig.width: 4
#| fig.height: 3
# Collected funds vs Updates plot
ggplot(df) +
    aes(y = collected_funds, x = updates_count) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Updates Count",
        title = "B. Collected Funds vs Updates"
    ) +
    theme_classic() +
    theme(text = element_text(size = 8))
```
:::
:::

# Model Diagnostics {.fragile}

::: columns
::: {.column width="40%"}
Model assumptions:

- Linearity ✓
- Normality ✓
- Homoscedasticity ✓
- Independence ✓

**Residual Analysis:**
```{r}
# Calculate key statistics
resid_stats <- data.frame(
  Model = c("Model T", "Model M", "Model Y"),
  Shapiro_p = c(
    shapiro.test(residuals(model_T))$p.value,
    shapiro.test(residuals(model_M))$p.value,
    shapiro.test(residuals(model_Y))$p.value
  )
)
```

Shapiro-Wilk p-values:
- Model T: `r round(resid_stats$Shapiro_p[1], 3)`
- Model M: `r round(resid_stats$Shapiro_p[2], 3)`
- Model Y: `r round(resid_stats$Shapiro_p[3], 3)`
:::

::: {.column width="60%"}
```{r}
#| fig.width: 5
#| fig.height: 4
par(mfrow = c(2,2), mar = c(2,2,2,1))
plot(model_Y, which = 1:4)
```
:::
:::