---
title: "Hypothesis Testing and Mediation Analysis"
author: "Your Name"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Required Libraries and Data Import

```{r}
# Load necessary libraries
library(ggplot2)
library(rio)
library(mediation)

# Import dataset
df <- rio::import("BE603_gr_10.csv")
```

## Hypothesis 1: Community Effect (Mediation Analysis)

### Models and Bootstrap

```{r, results='asis'}
model_T <- lm(collected_funds ~ updates_count, data = df)
model_M <- lm(comments_count ~ updates_count, data = df)
model_Y <- lm(collected_funds ~ updates_count + comments_count + pitch_size + campaign_quality + images, data = df)

model_bootstrap <- mediation::mediate(
    model.m = model_M,
    model.y = model_Y,
    treat = "updates_count",
    mediator = "comments_count",
    boot = TRUE,
    sims = 500
)
stargazer::stargazer(model_T, model_M, model_Y, type = "text")
```

### Visualization

```{r}
plot(model_bootstrap)
```
```{r}
# Plotting comments vs updates
ggplot(df) +
    aes(y = comments_count, x = updates_count) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Comments Count",
        x = "Updates Count"
    ) +
    theme_classic()
```

```{r}
# Plotting collected funds vs updates
ggplot(df) +
    aes(y = collected_funds, x = updates_count) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Updates Count"
    ) +
    theme_classic()
```
```{r}
# Residuals for model_T
residuals_T <- residuals(model_T)
ggplot(data.frame(residuals = residuals_T)) +
    aes(x = residuals) +
    geom_histogram(binwidth = 1000, fill = "blue", alpha = 0.7, color = "black") +
    labs(title = "Residuals of Model_T", x = "Residuals", y = "Frequency") +
    theme_classic()

# Residuals for model_M
residuals_M <- residuals(model_M)
ggplot(data.frame(residuals = residuals_M)) +
    aes(x = residuals) +
    geom_histogram(binwidth = 10, fill = "green", alpha = 0.7, color = "black") +
    labs(title = "Residuals of Model_M", x = "Residuals", y = "Frequency") +
    theme_classic()

# Residuals for model_Y
residuals_Y <- residuals(model_Y)
ggplot(data.frame(residuals = residuals_Y)) +
    aes(x = residuals) +
    geom_histogram(binwidth = 1000, fill = "red", alpha = 0.7, color = "black") +
    labs(title = "Residuals of Model_Y", x = "Residuals", y = "Frequency") +
    theme_classic()
```

# Hypothesis 2: Social and Negative Emotion Interaction

### Model

```{r, results='asis'}
model_H2 <- lm(collected_funds ~ social * negemo, data = df)
summary(model_H2)
```

### Visualization

```{r}
df$social_factor <- as.factor(df$social)

ggplot(df) +
    aes(y = collected_funds, x = negemo, color = social_factor) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Negative emotion",
        color = "Social (0/1)"
    ) +
    scale_color_discrete(labels = c("No Social", "Social")) +
    theme_classic()
```
```{r}
residuals_H2 <- residuals(model_H2)
ggplot(data.frame(residuals = residuals_H2)) +
    aes(x = residuals) +
    geom_histogram(binwidth = 1000, fill = "blue", alpha = 0.7, color = "black") +
    labs(title = "Residuals of Model_H2", x = "Residuals", y = "Frequency") +
    theme_classic()
```

## Hypothesis 3: Early Success

### Model and Visualization

```{r, results='asis'}
model_H3 <- lm(collected_funds ~ goal, data = df)
stargazer::stargazer(model_H3, type = "text")
```


```{r, results='asis'}
ggplot(df) +
    aes(y = collected_funds, x = goal) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Goal",
        title = "Correlation between goal and collected funds"
    ) +
    theme_classic()
```
```{r}
residuals_H3 <- residuals(model_H3)
ggplot(data.frame(residuals = residuals_H3)) +
    aes(x = residuals) +
    geom_histogram(binwidth = 1000, fill = "blue", alpha = 0.7, color = "black") +
    labs(title = "Residuals of Model_H3", x = "Residuals", y = "Frequency") +
    theme_classic()
```

```{r, results='asis'}
library(modelsummary)
library(broom)
library(dplyr)
summary(model_H3)
```
```{r}
library(corrplot)
cor_matrix <- cor(df[sapply(df, is.numeric)], use = "complete.obs")
corrplot(cor_matrix,
    method = "color", type = "upper",
    tl.col = "black", tl.srt = 45, 
    addCoef.col = "black", number.cex = 0.7 
)
```

```{r}
# Cook's distance for model_T
plot(cooks.distance(model_T), type = "h", main = "Cook's Distance for Model T")
abline(h = 4 / nrow(df), col = "red", lty = 2)

# Cook's distance for model_M
plot(cooks.distance(model_M), type = "h", main = "Cook's Distance for Model M")
abline(h = 4 / nrow(df), col = "red", lty = 2)

# Cook's distance for model_Y
plot(cooks.distance(model_Y), type = "h", main = "Cook's Distance for Model Y")
abline(h = 4 / nrow(df), col = "red", lty = 2)

# Cook's distance for model_H2
plot(cooks.distance(model_H2), type = "h", main = "Cook's Distance for Model H2")
abline(h = 4 / nrow(df), col = "red", lty = 2)

# Cook's distance for model_H3
plot(cooks.distance(model_H3), type = "h", main = "Cook's Distance for Model H3")
abline(h = 4 / nrow(df), col = "red", lty = 2)
```


