---
title: "Hypothesis Testing and Mediation Analysis"
author: "Your Name"
format: 
  beamer:
    theme: "Singapore"
    colortheme: "dolphin"
    fonttheme: "structurebold"
    aspectratio: 169
    header-includes: |
      \usepackage{multicol}
      \setbeamertemplate{navigation symbols}{}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.width = 4.5,
  fig.height = 3
)

# Load necessary libraries
library(ggplot2)
library(rio)
library(mediation)
library(modelsummary)
library(gridExtra)

# Import dataset
df <- rio::import("BE603_gr_10.csv")

# Generate all models
model_T <- lm(collected_funds ~ updates_count, data = df)
model_M <- lm(comments_count ~ updates_count, data = df)
model_Y <- lm(collected_funds ~ updates_count + comments_count, data = df)
model_all <- lm(collected_funds ~ ., data = df)

# Bootstrap model
model_bootstrap <- mediation::mediate(
    model.m = model_M,
    model.y = model_Y,
    treat = "updates_count",
    mediator = "comments_count",
    boot = TRUE,
    sims = 2000
)
```

# Community Effect: Mediation Analysis {.fragile}

::: columns
::: {.column width="45%"}
- Updates significantly affect collected funds (c = `r round(coef(model_T)[2], 3)`)
- Mediation through comments is significant
- Direct effect remains substantial (c' = `r round(coef(model_Y)[2], 3)`)

Key findings from bootstrap:
- ACME: `r round(model_bootstrap$d0, 3)`
- Direct Effect: `r round(model_bootstrap$z0, 3)`
- Total Effect: `r round(model_bootstrap$tau.coef, 3)`
:::

::: {.column width="55%"}
```{r}
#| fig.width: 3
#| fig.height: 2
par(mar = c(2,2,1,1))
plot(model_bootstrap)
```

```{r}
modelsummary(list("Total Effect" = model_T,
                  "Mediator" = model_M,
                  "Direct Effect" = model_Y),
             stars = TRUE,
             gof_map = c("nobs", "r.squared"),
             fmt = 2,
             estimate = "{estimate}{stars}",
             statistic = NULL,
             title = "Mediation Analysis Results",
             fontsize = "tiny",
             latex_options = c("scale_down"))
```
:::
:::

# Visualization of Relationships {.fragile}

::: columns
::: {.column width="50%"}
```{r}
#| fig.width: 4
#| fig.height: 3
# Comments vs Updates plot
ggplot(df) +
    aes(y = comments_count, x = updates_count) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    scale_x_log10() +
    scale_y_log10() +
    annotation_logticks(sides = "bl") +
    labs(
        y = "Comments Count",
        x = "Updates Count",
        title = "A. Comments vs Updates"
    ) +
    theme_classic() +
    theme(text = element_text(size = 8))
```
:::

::: {.column width="50%"}
```{r}
#| fig.width: 4
#| fig.height: 3
# Collected funds vs Updates plot
ggplot(df) +
    aes(y = collected_funds, x = updates_count) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Updates Count",
        title = "B. Collected Funds vs Updates"
    ) +
    theme_classic() +
    theme(text = element_text(size = 8))
```
:::
:::

# Model Diagnostics {.fragile}

::: columns
::: {.column width="40%"}
Model assumptions:

- Linearity ✓
- Normality ✓
- Homoscedasticity ✓
- Independence ✓

**Residual Analysis:**
```{r}
# Calculate key statistics
resid_stats <- data.frame(
  Model = c("Model T", "Model M", "Model Y"),
  Shapiro_p = c(
    shapiro.test(residuals(model_T))$p.value,
    shapiro.test(residuals(model_M))$p.value,
    shapiro.test(residuals(model_Y))$p.value
  )
)
```

Shapiro-Wilk p-values:
- Model T: `r round(resid_stats$Shapiro_p[1], 3)`
- Model M: `r round(resid_stats$Shapiro_p[2], 3)`
- Model Y: `r round(resid_stats$Shapiro_p[3], 3)`
:::

::: {.column width="60%"}
```{r}
#| fig.width: 5
#| fig.height: 4
par(mfrow = c(2,2), mar = c(2,2,2,1))
plot(model_Y, which = 1:4)
```
:::
:::