---
title: "Hypothesis Testing and Mediation Analysis"
author: "Your Name"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Required Libraries and Data Import

```{r}
library(ggplot2)
library(rio)
library(mediation)

df <- rio::import("BE603_gr_10.csv")
```

## Hypothesis 1: Community Effect (Mediation Analysis)

### Models and Bootstrap

```{r, results='asis'}
model_T <- lm(collected_funds ~ updates_count, data = df)
model_M <- lm(comments_count ~ updates_count, data = df)
model_Y <- lm(collected_funds ~ updates_count + comments_count + pitch_size + campaign_quality + images, data = df)

model_bootstrap <- mediation::mediate(
    model.m = model_M,
    model.y = model_Y,
    treat = "updates_count",
    mediator = "comments_count",
    boot = TRUE,
    sims = 500
)
stargazer::stargazer(model_T, model_M, model_Y, type = "text")
```

### Visualization

```{r}
plot(model_bootstrap)
```
```{r}
summary(model_bootstrap)
```


```{r}
ggplot(df) +
    aes(y = comments_count, x = updates_count) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Comments Count",
        x = "Updates Count"
    ) +
    theme_classic()
```

```{r}
ggplot(df) +
    aes(y = collected_funds, x = updates_count) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Updates Count"
    ) +
    theme_classic()
```

# Hypothesis 2: Social and Negative Emotion Interaction

### Model

```{r, results='asis'}
model_H2 <- lm(collected_funds ~ social * negemo, data = df)
summary(model_H2)
```

### Visualization

```{r}
df$social_factor <- as.factor(df$social)

ggplot(df) +
    aes(y = collected_funds, x = negemo, color = social_factor) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Negative emotion",
        color = "Social (0/1)"
    ) +
    scale_color_discrete(labels = c("No Social", "Social")) +
    theme_classic()
```

## Hypothesis 3: Early Success

### Model and Visualization

```{r, results='asis'}
model_H3 <- lm(collected_funds ~ goal, data = df)
stargazer::stargazer(model_H3, type = "text")
```


```{r, results='asis'}
ggplot(df) +
    aes(y = collected_funds, x = goal) +
    geom_hline(yintercept = 1, linetype = "dashed", alpha = 0.5) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "lm", formula = "y ~ x", se = TRUE) +
    labs(
        y = "Collected funds",
        x = "Goal",
        title = "Correlation between goal and collected funds"
    ) +
    theme_classic()
```

```{r, results='asis'}
summary(model_H3)
```
```{r}
library(corrplot)
cor_matrix <- cor(df[sapply(df, is.numeric)], use = "complete.obs")
corrplot(cor_matrix,
    method = "color", type = "upper",
    tl.col = "black", tl.srt = 45,
)
```

```{r, fig.width=12, fig.height=6}
par(mfrow = c(2, 5), mar = c(2, 2, 2, 1))

plot_residuals <- function(model, title) {
    hist(residuals(model),
        breaks = 100,
        probability = TRUE,
        main = title,
        xlab = "Residuals",
        col = "lightgray",
        border = "white"
    )
    lines(density(residuals(model)), col = "blue", lwd = 2)
}

plot_residuals(model_H2, "Hypothesis 1: Model Residuals")
plot_residuals(model_T, "Hypothesis 2: Model T Residuals")
plot_residuals(model_M, "Hypothesis 2: Model M Residuals")
plot_residuals(model_Y, "Hypothesis 2: Model Y Residuals")
plot_residuals(model_H3, "Hypothesis 3: Model Residuals")

plot(cooks.distance(model_H2), type = "h", main = "Hypothesis 1: Cook's Distance", xlab = "", ylab = "")
abline(h = 4 / nrow(df), col = "red", lty = 2)

plot(cooks.distance(model_T), type = "h", main = "Hypothesis 2: T Cook's Distance", xlab = "", ylab = "")
abline(h = 4 / nrow(df), col = "red", lty = 2)

plot(cooks.distance(model_M), type = "h", main = "Hypothesis 2: M Cook's Distance", xlab = "", ylab = "")
abline(h = 4 / nrow(df), col = "red", lty = 2)

plot(cooks.distance(model_Y), type = "h", main = "Hypothesis 2: Y Cook's Distance", xlab = "", ylab = "")
abline(h = 4 / nrow(df), col = "red", lty = 2)

plot(cooks.distance(model_H3), type = "h", main = "Hypothesis 3: Cook's Distance", xlab = "", ylab = "")
abline(h = 4 / nrow(df), col = "red", lty = 2)

par(mfrow = c(1, 1))
```